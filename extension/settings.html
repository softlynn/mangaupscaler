<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Manga Upscaler Settings</title>
  <link rel="stylesheet" href="settings.css" />
</head>
<body>
  <div class="wrap">
    <header class="top">
      <div class="brand">
        <img class="logo" src="icons/icon48.png" alt="">
        <div>
          <div class="title">Manga Upscaler</div>
          <div class="subtitle">Full settings + per-site whitelist</div>
        </div>
      </div>
      <div class="actions">
        <button id="saveBtn" class="btn primary">Save</button>
      </div>
    </header>

    <section class="card">
      <h3>General</h3>

      <div class="row">
        <div>
          <div class="label">Enabled (local host)</div>
          <div class="sub">Master toggle for AI enhance</div>
        </div>
        <div id="enabled" class="toggle"><div class="knob"></div></div>
      </div>

      <div class="row">
        <div>
          <div class="label">Auto enhance panel in view</div>
          <div class="sub">Runs when you scroll to a new page/panel</div>
        </div>
        <div id="autoPanel" class="toggle"><div class="knob"></div></div>
      </div>

      <div class="row">
        <div>
          <div class="label">Show toast notifications</div>
          <div class="sub">Shows “Enhanced” popups in the corner</div>
        </div>
        <div id="showToast" class="toggle"><div class="knob"></div></div>
      </div>

      <div class="row">
        <div>
          <div class="label">AI Quality</div>
          <div class="sub">Fast, balanced, or best quality</div>
        </div>
        <select id="aiQuality">
          <option value="fast">Fast</option>
          <option value="balanced">Balanced</option>
          <option value="best">Best</option>
        </select>
      </div>

      <div class="row">
        <div>
          <div class="label">Allow DAT2 (highest quality, very slow)</div>
          <div class="sub">Uses Illustration DAT2 when available for Best quality</div>
        </div>
        <div id="allowDat2" class="toggle"><div class="knob"></div></div>
      </div>

      <div class="grid2">
        <label class="field">
          <div>Scale</div>
          <select id="scale">
            <option value="2">2x</option>
            <option value="3">3x</option>
            <option value="4">4x</option>
          </select>
        </label>

        <label class="field">
          <div>Pre-upscale next pages</div>
          <input id="preUpscaleCount" type="range" min="0" max="5" step="1" />
          <div class="val" id="preVal"></div>
        </label>
      </div>

      <p class="hint">
        Tip: for best clarity, turn on <b>AI Enhance</b> and run the local host. MangaJaNai models are designed to restore halftones and clean JPEG/moire artifacts.
      </p>
      <p class="hint">
        Real-ESRGAN ncnn-vulkan needs NCNN-format models (.bin/.param), not raw .pth files.
      </p>
    </section>

    <section class="card cacheCard">
      <h3>Cache</h3>
      <div class="grid2 cacheGrid">
        <label class="field">
          <div>Cache limit (GB)</div>
          <input id="cacheMaxGb" type="number" min="0" step="0.1" />
          <div class="val" id="cacheMaxGbVal"></div>
        </label>

        <label class="field">
          <div>Max age (days)</div>
          <input id="cacheMaxAgeDays" type="number" min="0" step="1" />
          <div class="val" id="cacheMaxAgeDaysVal"></div>
        </label>
      </div>
      <div class="grid2 cacheGrid">
        <label class="field">
          <div>Idle shutdown (minutes)</div>
          <input id="idleShutdownMinutes" type="number" min="0" step="1" />
          <div class="val" id="idleShutdownMinutesVal"></div>
        </label>
      </div>
      <div class="row">
        <div>
          <div class="label">Clear host cache</div>
          <div class="sub">Removes stored enhanced images (keeps models)</div>
        </div>
        <button id="clearCache" class="btn">Clear cache</button>
      </div>
    </section>

    <section class="card">
      <div class="wlHead">
        <div>
          <h3>Whitelist (per site)</h3>
          <div class="sub">Extension is OFF everywhere unless a site is enabled here.</div>
        </div>
        <input id="filter" placeholder="Search domains" />
      </div>

      <div id="whitelistList" class="wlList"></div>

      <div class="addRow">
        <input id="customDomain" placeholder="Add custom domain (e.g. example.com)" />
        <button id="addDomain" class="btn">Add</button>
      </div>
    </section>

    <section class="card creditsWrap">
      <div class="creditsTitle">
        <div class="pfp big"><img src="assets/heartgray2x.png" alt=""></div>
        <div>
          <div class="label">Credits</div>
          <div class="sub">Creator: Softlynn</div>
        </div>
      </div>
      <div class="creditLinks">
        <a class="btn link" href="https://softlynn.carrd.co/#" target="_blank" rel="noreferrer">Website</a>
        <a class="btn link" href="https://www.paypal.com/paypalme/softlynn" target="_blank" rel="noreferrer">Support me</a>
      </div>
    </section>

    <section class="card">
      <h3>Local AI Host</h3>
      <div class="row">
        <div>
          <div class="label">Download MangaJaNai models</div>
          <div class="sub">Downloads Manga + Illustration models from the official release</div>
        </div>
        <button id="downloadModels" class="btn">Download</button>
      </div>
      <div class="row">
        <div>
          <div class="label">Tray controls</div>
          <div class="sub">Start or stop the tray process manually</div>
        </div>
        <div style="display:flex; gap:8px;">
          <button id="startTray" class="btn">Start tray</button>
          <button id="stopTray" class="btn">Stop tray</button>
        </div>
      </div>
      <ol class="steps">
        <li>Unzip the <code>native_host/</code> folder from this extension zip.</li>
        <li>Run <code>install_windows.ps1</code> (installs deps, registers native messaging, downloads models).</li>
        <li>Enable AI Enhance in the popup; the tray host will start on demand.</li>
        <li>Optional: run <code>run_host.bat --console</code> for debugging.</li>
      </ol>
      <p class="hint">When running, the host serves enhanced images at <code>http://127.0.0.1:48159/enhance</code>. The extension fetches results in the background and swaps the panel to a <code>blob:</code> URL (avoids site CORS/Private Network blocks).</p>
    </section>
  </div>

  <script src="settings.js"></script>
</body>
</html>
